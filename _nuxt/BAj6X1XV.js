import{l as A,m as k,r as c,v as p,x as y,u as B}from"./DqA0wvgn.js";import{u as h}from"./CWY8yeRe.js";const T=window.setInterval,C=A("auth",()=>{const g=B(),t=k({get token(){return sessionStorage.getItem("user-token")||null},set token(e){e?sessionStorage.setItem("user-token",e):sessionStorage.removeItem("user-token")},get username(){return sessionStorage.getItem("user-username")||null},set username(e){e?sessionStorage.setItem("user-username",e):sessionStorage.removeItem("user-username")},get isAuthenticated(){return sessionStorage.getItem("user-authStatus")=="true"||!1},set isAuthenticated(e){sessionStorage.setItem("user-authStatus",e.toString())},get isAdmin(){return sessionStorage.getItem("user-isAdmin")=="true"||!1},set isAdmin(e){sessionStorage.setItem("user-isAdmin",e.toString())},get trainerId(){const e=sessionStorage.getItem("user-trainerId");return e!==null&&e!==""?parseInt(e):null},set trainerId(e){e&&sessionStorage.setItem("user-trainerId",e.toString())}}),s=c(!1),l=c(!1),S=p(),r=y(),d=c(null),v=e=>{d.value=e},I=async(e,u)=>{var i;if(s.value=!0,l.value=!1,!e||!u)return r.add({severity:"error",summary:"Bitte prüfen Sie Ihre Eingaben",detail:"Benutzername und Passwort erforderlich",life:3e3}),s.value=!1,!1;const{data:a,error:n}=await h(`${g.public.apiBase}/login`,{method:"POST",body:{username:e,password:u},headers:{"Content-Type":"application/json"}},"$HkqiVTyIB8");if(s.value=!1,n.value)return l.value=!0,n.value.statusCode===400?r.add({severity:"error",summary:"Login fehlgeschlagen",detail:"Falsche Anmeldedaten",life:3e3}):r.add({severity:"error",summary:"Serverfehler",detail:"Ein Serverfehler ist aufgetreten. Bitte versuchen Sie es später erneut.",life:3e3}),!1;if((i=a.value)!=null&&i.token){t.token=a.value.token,t.username=e,await m();const o=d.value||"/management";return v(null),S.push(o),r.add({severity:"success",summary:"Login erfolgreich",detail:"Willkommen zurück!",life:3e3}),!0}s.value=!1},m=async()=>{var a,n,i,o;if(!t.token)return t.isAuthenticated=!1,t.isAdmin=!1,!1;const{data:e,error:u}=await h(`${g.public.apiBase}/login`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.token}`}},"$rJffoUiud8");return u.value?(r.add({severity:"error",summary:"Ihre aktuelle Sitzung ist abgelaufen",detail:"Bitte melden Sie sich erneut an",life:3e3}),f(),!1):(((a=e.value)==null?void 0:a.status)==="valid"?(t.isAuthenticated=!0,t.username=(n=e.value)==null?void 0:n.user,t.isAdmin=(i=e.value)==null?void 0:i.admin,t.trainerId=(o=e.value)==null?void 0:o.trainerId):f(),!0)},f=()=>{t.token=null,t.username=null,t.isAuthenticated=!1,t.isAdmin=!1,t.trainerId=null};return T(()=>{t.isAuthenticated&&m()},15*60*999),{user:t,loading:s,invalid:l,login:I,logout:f,checkAuthStatus:m,redirectRoute:d,setRedirectRoute:v}});export{T as s,C as u};
