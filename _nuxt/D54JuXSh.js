import{l as q,r as d,q as M,n as W,L as J,x as Q,u as V}from"./DqA0wvgn.js";import{t as D}from"./iBF5vbor.js";import{u as X,s as K}from"./BAj6X1XV.js";import{u as U}from"./BPKLwf0D.js";import{u as b}from"./CWY8yeRe.js";const re=q("privEvent",()=>{const s=X(),$=V(),B=U(),S=d([]),A=d(new Date(sessionStorage.getItem("selectedDate")||new Date));M(A,t=>{sessionStorage.setItem("selectedDate",D(t))});const R=W(()=>D(A.value)),w=d(0);async function v(){s.user.isAuthenticated&&(S.value=await C(R.value)),w.value=0}J(async()=>{await v()});const G=d("16:00"),N=16,L=d("21:00"),k=20,c=Q();async function C(t){var g,o,p,m,l,h,y;if(!s.user.isAuthenticated)return[];const n=`${t} ${G.value}`,i=L.value,e=d([]),{data:a,status:T,error:u}=await b(`${$.public.apiBase}/events/${n}/${i}/field1,field2,field3`,{server:!1,method:"GET",headers:{Authorization:`Bearer ${s.user.token}`,"Content-Type":"application/json"}},"$-XvD-bvcNv");if(((g=u.value)==null?void 0:g.statusCode)===401&&(s.user.isAuthenticated=!1),u.value||!a.value)return[];for(let f=N;f<=k;f++)for(let P of[0,30]){const E=`${t} ${f.toString().padStart(2,"0")}:${P.toString().padStart(2,"0")}:00`,I={time:E,field1:null,field2:null,field3:null};(p=(o=a.value)==null?void 0:o.field1)==null||p.forEach(r=>{r.startTime===E&&(I.field1={team:r.team,trainer:r.trainer,resId:r.resId,resGroupId:r.resGroupId,groupName:r.groupName})}),(l=(m=a.value)==null?void 0:m.field2)==null||l.forEach(r=>{r.startTime===E&&(I.field2={team:r.team,trainer:r.trainer,resId:r.resId,resGroupId:r.resGroupId,groupName:r.groupName})}),(y=(h=a.value)==null?void 0:h.field3)==null||y.forEach(r=>{r.startTime===E&&(I.field3={team:r.team,trainer:r.trainer,resId:r.resId,resGroupId:r.resGroupId,groupName:r.groupName})}),e.value.push(I)}return S.value=e.value,console.log(e.value),e.value}async function z(t){var a;if(!s.user.isAuthenticated)return!1;const{data:n,status:i,error:e}=await b(`${$.public.apiBase}/event`,{server:!1,method:"POST",headers:{Authorization:`Bearer ${s.user.token}`,"Content-Type":"application/json"},body:{startTime:`${t.date} ${t.startTime}`,endTime:t.endTime,fieldArray:t.fieldArray,team:t.team,trainer:t.trainer,recurring:t.recurring}},"$xiERdqeQJO");if(e.value){if(((a=e.value)==null?void 0:a.statusCode)===401){s.user.isAuthenticated=!1;return}console.error(e.value.data.message),c.add({severity:"error",summary:"Fehler",detail:`Reservierung konnte nicht hinzugefügt werden: ${e.value.data.message}`,life:3e3})}if(i.value==="success")return c.add({severity:"success",summary:"Erfolgreich",detail:"Reservierung erfolgreich hinzugefügt",life:3e3}),n.value}async function F(t){var a;if(!s.user.isAuthenticated)return!1;const{data:n,status:i,error:e}=await b(`${$.public.apiBase}/event/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${s.user.token}`,"Content-Type":"application/json"}},"$9MA2uVhCy1");if(e.value){if(((a=e.value)==null?void 0:a.statusCode)===401){s.user.isAuthenticated=!1;return}c.add({severity:"error",summary:"Fehler beim Löschen der Reservierung",detail:`${e.value.data.message}`,life:6e3})}if(i.value==="success")return c.add({severity:"success",summary:"Erfolgreich",detail:"Reservierung erfolgreich gelöscht",life:3e3}),await v(),n.value}async function j(t){var a;if(!s.user.isAuthenticated)return!1;const{data:n,status:i,error:e}=await b(`${$.public.apiBase}/eventRecurring/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${s.user.token}`,"Content-Type":"application/json"}},"$3W8f08SuH7");if(e.value){if(((a=e.value)==null?void 0:a.statusCode)===401){s.user.isAuthenticated=!1;return}c.add({severity:"error",summary:"Fehler beim Löschen der Reservierung",detail:`${e.value.data.message}`,life:6e3})}return i.value==="success"&&c.add({severity:"success",summary:"Erfolgreich",detail:"Reservierung erfolgreich gelöscht",life:3e3}),await v(),n.value}function O(t){var p,m;const n=S.value.filter(l=>{var h,y,f;return((h=l.field1)==null?void 0:h.resGroupId)===t||((y=l.field2)==null?void 0:y.resGroupId)===t||((f=l.field3)==null?void 0:f.resGroupId)===t});if(n.length===0)return!1;const i=n.map(l=>l.time);if(!i)return!1;let e=i[0],a=i[i.length-1],T=(p=e==null?void 0:e.split(" ")[1])==null?void 0:p.substring(0,5),u=(m=a==null?void 0:a.split(" ")[1])==null?void 0:m.substring(0,5),g=Number(u==null?void 0:u.split(":")[0]),o=Number(u==null?void 0:u.split(":")[1]);return o+=30,o>=60&&(g+=1,o=o-60),u=`${String(g).padStart(2,"0")}:${String(o).padStart(2,"0")}`,T&&u?{startTime:T,endTime:u}:!1}const x=d(["16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00"]),H=d([{label:"Einmalig",value:"none"},{label:"Wöchentlich",value:"weekly"}]);return K(v,B.updateInterval*1e3),{reservations:S,times:x,isLoading:w,selectedDate:A,currentDate:R,recurringOptions:H,addEvent:z,getReservations:v,getPriviledgedReservationsByDay:C,getStartAndEndTimeForResGroupId:O,deleteEvent:F,deleteRecurringEvent:j}});export{re as u};
