<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cars</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              poppins: ["Poppins", "sans-serif"],
            },
            keyframes: {
              periodicScale: {
                "0%, 5%, 100%": { transform: "rotate(-1deg) scale(1)" },
                "2.5%": { transform: "rotate(-1deg) scale(1.05)" },
              },
            },
            animation: {
              "periodic-scale": "periodicScale 6s infinite",
            },
          },
        },
      };
    </script>

    <script defer type="module">
      import autoAnimate from "https://cdn.jsdelivr.net/npm/@formkit/auto-animate";

      autoAnimate(document.getElementById("cars"));

      let data = null;

      let xmlhttp = new XMLHttpRequest();
      const url = "data.json";

      xmlhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          data = JSON.parse(this.responseText);

          displayAppName();
          displayCars();

          console.log(data);
        }
      };
      xmlhttp.open("GET", url, true);

      xmlhttp.send();

      function displayAppName() {
        console.log("data:", data);
        if (data) {
          let appName = document.getElementById("appName");
          console.log(data.appName);
          appName.innerHTML = data.appName;
        }
      }

      function displayCars() {
        let cars = data.cars;

        let carsDiv = document.getElementById("cars");

        cars.forEach((car) => {
          createCarDOM(car);
        });
      }

      function createCarDOM(car) {
        let carDiv = document.createElement("div");
        carDiv.className =
          "relative w-[342px] min-h-64 h-fit border border-gray-300 dark:border-zinc-600 rounded-lg shadow-md text-md text-gray-900 dark:text-gray-200 overflow-hidden";
        carDiv.setAttribute("id", "car-" + car.id);

        // Create the delete button and position it
        let deleteCarButton = document.createElement("button");
        deleteCarButton.className =
          "absolute top-2 right-2 z-10 bg-red-500 text-white rounded-full h-8 w-8 flex items-center justify-center";
        deleteCarButton.innerHTML = "X";
        deleteCarButton.onclick = function () {
          removeCarDOM(car.id);
        };
        carDiv.appendChild(deleteCarButton);

        // Create the image element
        let img = document.createElement("img");
        img.className = "h-48 w-full object-cover";
        img.src = car.img;
        carDiv.appendChild(img);

        // Create the car info section
        let carInfo = document.createElement("div");
        carInfo.className = "p-4";
        carDiv.appendChild(carInfo);

        // Create and append car title
        let carTitle = document.createElement("h2");
        carTitle.className =
          "text-xl font-bold text-gray-950 dark:text-zinc-200";
        carTitle.innerHTML = car.manufacturer + " " + car.model;
        carInfo.appendChild(carTitle);

        // Append manufacturing year
        let bj = document.createElement("p");
        bj.innerHTML = "Manufacturing year: " + car.year;
        carInfo.appendChild(bj);

        // Append horsepower
        let hp = document.createElement("p");
        hp.innerHTML = "Horsepower: " + car.hp;
        carInfo.appendChild(hp);

        // Append kilometres
        let km = document.createElement("p");
        km.innerHTML = "Kilometres: " + car.km.toLocaleString("de-DE");
        carInfo.appendChild(km);

        // Append seats
        let seats = document.createElement("p");
        seats.innerHTML = "Seats: " + car.seats;
        carInfo.appendChild(seats);

        // Create the price section
        let priceDiv = document.createElement("div");
        priceDiv.className =
          "flex justify-between bg-gray-600 items-center px-4 py-2";
        carDiv.appendChild(priceDiv);

        // Append price tag
        let priceTag = document.createElement("span");
        priceTag.innerHTML = "â‚¬" + car.price.toLocaleString("de-DE");
        priceTag.className = "text-blue-500 italic font-bold text-lg";
        priceDiv.appendChild(priceTag);

        // Create contact button
        let button = document.createElement("button");
        button.className =
          "bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-2 rounded";
        button.innerHTML = "Contact";
        button.onclick = function () {
          window.location.href = `mailto:${car.email}?subject=Inquiry about ${car.manufacturer} ${car.model}&body=Hello, I'm interested in your ${car.manufacturer} ${car.model} from ${car.year}.`;
        };
        priceDiv.appendChild(button);

        // Append the car card to the cars container
        document.getElementById("cars").appendChild(carDiv);
      }

      window.createCarDOM = createCarDOM;

      function removeCarDOM(carId) {
        let carDiv = document.getElementById("car-" + carId);
        carDiv.remove();
      }
      window.removeCarDOM = removeCarDOM;

      function createCar() {
        let car = {
          id: data.cars.length + 1,
          manufacturer: document.getElementById("manufacturer").value,
          model: document.getElementById("buildModel").value,
          year: document.getElementById("buildYear").value,
          hp: document.getElementById("horsepower").value,
          km: document.getElementById("kilometres").value,
          seats: document.getElementById("seats").value,
          price: document.getElementById("price").value,
          img: document.getElementById("image").value,
          email: document.getElementById("email").value,
        };
        console.log(car);

        createCarDOM(car);

        closeDialog();
      }
      window.createCar = createCar;

      function openDialog() {
        if (document.getElementById("dialog-bg")) {
          return;
        }
        const dialog = document.createElement("div");
        dialog.id = "dialog-bg";
        dialog.className = "absolute top-0 left-0 w-full h-full inset-0 flex items-center justify-center bg-black bg-opacity-50";
        dialog.onclick = function () {
          closeDialog();
        };
        autoAnimate(dialog);

        dialog.innerHTML = `       
            <div id="dialog-container" class="z-50 w-[464px] max-w-[90vw] h-fit min-h-[400px] max-h-[80vh] overflow-y-auto bg-gray-200 dark:bg-zinc-700 p-6 rounded-lg shadow-lg" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-950 dark:text-zinc-300">Add Car for Sale</h2>
                    <button onclick="closeDialog()" class="relative text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div class="mb-4">
                    <label for="manufacturer" class="block text-sm text-gray-500 dark:text-gray-300">Manufacturer</label>
                    <input type="text" id="manufacturer" placeholder="Volkswagen" class="block mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
                </div>
                <div class="mb-4">
                    <label for="buildModel" class="block text-sm text-gray-500 dark:text-gray-300">Model</label>
                    <input type="text" id="buildModel" placeholder="Enter model" class="block mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
                </div>
                <div class="mb-4">
                    <label for="buildYear" class="block text-sm text-gray-500 dark:text-gray-300">Build Year</label>
                    <input type="number" id="buildYear" placeholder="Enter build year" class="block mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
                </div>
                <div class="mb-4">
                    <label for="seats" class="block text-sm text-gray-500 dark:text-gray-300">Seats</label>
                    <input type="number" id="seats" placeholder="Enter number of seats" class="block mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
                </div>
                <div class="mb-4">
                    <label for="horsepower" class="block text-sm text-gray-500 dark:text-gray-300">Horsepower</label>
                    <input type="number" id="horsepower" placeholder="Enter horsepower" class="block mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
                </div>
                <div class="mb-4">
                    <label for="kilometres" class="block text-sm text-gray-500 dark:text-gray-300">Kilometres</label>
                    <input type="number" id="kilometres" placeholder="Enter kilometres" class="block mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
                </div>
                <div class="mb-4">
                    <label for="image" class="block text-sm text-gray-500 dark:text-gray-300">Image URL</label>
                    <input type="text" id="image" placeholder="Enter image URL" class="block mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
                </div>
                <div class="mb-4">
                    <label for="price" class="block text-sm text-gray-500 dark:text-gray-300">Price</label>
                    <input id="price" type="number" placeholder="20000" class="block mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
                </div>
                <div class="mb-4">
                    <label for="email" class="block text-sm text-gray-500 dark:text-gray-300">Email Address</label>
                    <div class="relative flex items-center mt-2">
                        <span class="absolute">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mx-3 text-gray-400 dark:text-gray-500">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                            </svg>
                        </span>
                        <input type="email" id="email" placeholder="john@example.com" class="block w-full py-2.5 text-gray-700 placeholder-gray-400/70 bg-white border border-gray-200 rounded-lg pl-11 pr-5 rtl:pr-11 rtl:pl-5 dark:bg-gray-900 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 dark:focus:border-blue-300 focus:ring-blue-300 focus:outline-none focus:ring focus:ring-opacity-40" />
                    </div>
                </div>
                <div class="text-right">
                    <button onclick="closeDialog()" class="px-4 py-2 bg-red-500 text-white rounded">Cancel</button>
                    <button onclick="createCar()" class="px-4 py-2 bg-blue-500 text-white rounded">Create</button>
                </div>
            </div>
     
    `;

        // Append the dialog to the body
        document.getElementsByTagName("body")[0].appendChild(dialog);

        autoAnimate(document.getElementById("dialog-bg"));

        // Show the dialog
        const dialogBg = document.getElementById("dialog-bg");
        dialogBg.classList.remove("hidden");
      }
      window.openDialog = openDialog;

      function closeDialog() {
        const dialogBg = document.getElementById("dialog-bg");
        if (dialogBg) {
          dialogBg.classList.add("hidden"); // Hide the dialog
          dialogBg.remove(); // Remove dialog from DOM
        }
      }
      window.closeDialog = closeDialog;
    </script>
  </head>

  <body class="bg-gray-100 dark:bg-gray-800 font-poppins">
    <div class="flex justify-center items-center my-12">
      <h1
        id="appName"
        class="text-2xl xl:text-4xl font-bold tracking-wide uppercase bg-gradient-to-r from-purple-400 via-pink-500 to-red-500 bg-clip-text text-transparent shadow-lg p-4 rounded-lg -rotate-1 animate-periodic-scale"
      >
        Hello World!
      </h1>
    </div>

    <div class="flex justify-center">
      <button
        onclick="openDialog()"
        class="px-4 py-2 bg-blue-500 text-white rounded"
      >
        Add Car for Sale!
      </button>
    </div>

    <div
      id="cars"
      class="max-w-7xl mx-auto p-4 flex flex-wrap gap-6 justify-center"
    ></div>
  </body>
</html>
